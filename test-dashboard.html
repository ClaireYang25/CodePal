<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gmail OTP AutoFill - Test Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; padding: 20px; max-width: 800px; margin: 20px auto; color: #333; }
        .section { border: 1px solid #e0e0e0; padding: 20px; margin-bottom: 25px; border-radius: 12px; background-color: #f9f9f9; }
        h1, h2 { color: #1a73e8; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        h1 { text-align: center; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; }
        input { padding: 10px; font-size: 16px; width: calc(100% - 22px); border-radius: 6px; border: 1px solid #ccc; }
        input:focus { border-color: #1a73e8; box-shadow: 0 0 5px rgba(26, 115, 232, 0.5); outline: none;}
        button { padding: 12px 18px; margin-right: 10px; cursor: pointer; background-color: #1a73e8; color: white; border: none; border-radius: 6px; font-size: 14px; transition: background-color 0.3s; }
        button:hover { background-color: #1558b3; }
        #status { margin-top: 15px; font-weight: bold; padding: 10px; border-radius: 6px; background-color: #e8f0fe; color: #1a73e8; }
    </style>
</head>
<body>

    <h1>Gmail OTP AutoFill - Test Dashboard</h1>

    <div class="section">
        <h2>1. Autofill & Intent Listener Test</h2>
        <p>Click (focus) on any input field below. This should trigger the extension's "high alert" mode. Once an OTP email is sent and processed, the code should be automatically filled into the focused field.</p>
        <div class="input-group">
            <label for="otp-input">Standard OTP Field (autocomplete="one-time-code"):</label>
            <input type="text" id="otp-input" autocomplete="one-time-code" placeholder="Focus here to test autofill">
        </div>
        <div class="input-group">
            <label for="name-input">Keyword-based OTP Field (name="verification_code"):</label>
            <input type="text" id="name-input" name="verification_code" placeholder="Focus here to test autofill">
        </div>
         <div class="input-group">
            <label for="id-input">ID-based OTP Field (id="otp_code_input"):</label>
            <input type="text" id="id-input" id="otp_code_input" placeholder="Focus here to test autofill">
        </div>
    </div>

    <div class="section">
        <h2>2. OTP Extraction Test (End-to-End)</h2>
        <p>Click a button to send a specific type of test email to your Gmail account. Monitor the extension popup and the input fields above.</p>
        <button onclick="sendMail('simple')">Send Simple Email (OTP: 123456)</button>
        <button onclick="sendMail('complex')">Send Complex Email (OTP: 654321)</button>
        <button onclick="sendMail('multilingual')">Send Multilingual Email (OTP: 789012)</button>
        <button onclick="sendMail('short')">Send Short OTP Email (OTP: 7, Should be rejected)</button>
        <button onclick="sendMail('non-otp')">Send Non-OTP Email (Should be ignored)</button>
        <div id="status"></div>
    </div>

    <script>
        // IMPORTANT: Replace this with your own Google Apps Script Web App URL
        const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbza_dDh7D1L-PlJWYZiB_lTe0B2FOOXFq1bnAOvyPp7vo2SAyHWrTGK4HUxQowdIwNaRw/exec';

        async function sendMail(type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = `Sending '${type}' email... Please wait.`;
            statusDiv.style.backgroundColor = '#e8f0fe';
            statusDiv.style.color = '#1a73e8';

            if (appsScriptUrl === 'YOUR_APPS_SCRIPT_URL') {
                statusDiv.textContent = 'Error: Please replace "YOUR_APPS_SCRIPT_URL" in test-dashboard.html with your Google Apps Script URL.';
                statusDiv.style.backgroundColor = '#fce8e6';
                statusDiv.style.color = '#c5221f';
                return;
            }
            
            try {
                // Using GET request as defined in the Apps Script doGet(e) function
                const response = await fetch(`${appsScriptUrl}?type=${type}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const result = await response.json();
                
                if (result.status === 'success') {
                    statusDiv.textContent = `✅ Success! Sent '${result.type}' email. Check your inbox and the extension.`;
                    statusDiv.style.backgroundColor = '#e6f4ea';
                    statusDiv.style.color = '#1e8e3e';
                } else {
                    throw new Error(result.message || 'Unknown error from Apps Script.');
                }
            } catch (error) {
                statusDiv.textContent = `❌ Error: ${error.message}`;
                statusDiv.style.backgroundColor = '#fce8e6';
                statusDiv.style.color = '#c5221f';
            }
        }
    </script>

</body>
</html>
